# LLVMUP Installation Guide

This guide covers the different ways to install LLVMUP using environment variables for customization.

## Quick Start

Default installation (recommended for most users):
```bash
./install.sh
```

This installs LLVMUP to `~/.local/bin` and configures your shell profile automatically.

## Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `LLVMUP_PREFIX` | Base installation prefix | `$HOME/.local` |
| `LLVMUP_INSTALL_DIR` | Directory for executable scripts | `$LLVMUP_PREFIX/bin` |
| `LLVMUP_COMPLETION_DIR` | Directory for bash completion | `$LLVMUP_PREFIX/share/bash-completion/completions` |
| `LLVMUP_SYSTEM_INSTALL` | Set to 1 for system-wide installation | `0` (user install) |

## Installation Examples

### 1. Default User Installation
```bash
./install.sh
```
- Installs to `~/.local/bin`
- Automatically configures shell profile
- Most common choice for individual users

### 2. Custom User Directory
```bash
LLVMUP_INSTALL_DIR=~/bin ./install.sh
```
- Install scripts to `~/bin` instead of `~/.local/bin`
- Useful if you prefer a different directory structure

### 3. Custom Prefix
```bash
LLVMUP_PREFIX=~/.llvmup ./install.sh
```
- Install to `~/.llvmup/bin` and `~/.llvmup/share/bash-completion/completions`
- Keeps all LLVMUP files in a dedicated directory

### 4. System-Wide Installation
```bash
LLVMUP_SYSTEM_INSTALL=1 ./install.sh
```
- Install to `/usr/local/bin` (requires sudo)
- Available to all users on the system
- Does not modify individual user shell profiles
- Users need to manually source the functions

### 5. Custom System Directory
```bash
LLVMUP_PREFIX=/opt/llvmup ./install.sh
```
- Install to `/opt/llvmup/bin`
- Useful for package managers or custom system layouts

### 6. Development/Testing Setup
```bash
LLVMUP_PREFIX=$PWD/test-install ./install.sh
```
- Install to current directory for testing
- Useful for development and CI/CD pipelines

## Uninstallation

Use the same environment variables for uninstallation:

```bash
# Uninstall from default location
./uninstall.sh

# Uninstall from custom prefix
LLVMUP_PREFIX=/custom/path ./uninstall.sh

# Uninstall system-wide installation
LLVMUP_SYSTEM_INSTALL=1 ./uninstall.sh
```

## Interactive Installation

For guided installation, use:
```bash
./install-examples.sh
```

This script provides an interactive menu to choose installation options.

## Post-Installation

### For User Installations
- Shell profile is automatically configured
- Restart terminal or run `source ~/.bashrc`
- Functions are available immediately

### For System-Wide Installations
- Add to system-wide profile: `/etc/profile.d/llvmup.sh`
- Or users add to their profile: `source /usr/local/bin/llvm-functions.sh`

### Verify Installation
```bash
llvmup --help
llvm-status
```

## PATH Configuration

Ensure the installation directory is in your PATH:

```bash
# Temporary (current session)
export PATH="/path/to/llvmup/bin:$PATH"

# Permanent (add to ~/.bashrc or ~/.profile)
echo 'export PATH="/path/to/llvmup/bin:$PATH"' >> ~/.bashrc
```

## Troubleshooting

### Permission Issues
- For system installs, ensure you have sudo access
- For user installs, check directory permissions

### PATH Issues
- Verify installation directory is in PATH
- Use full paths if needed: `/path/to/bin/llvmup`

### Profile Configuration
- Check if shell profile was modified correctly
- Manually add source line if needed
- Verify with `which llvm-activate` (should show function, not file)

## Advanced Usage

### CI/CD Integration
```bash
# Non-interactive installation for CI
LLVMUP_PREFIX=/opt/llvmup ./install.sh

# Add to PATH in CI scripts
export PATH="/opt/llvmup/bin:$PATH"
```

### Container/Docker Usage
```bash
# Install in container
LLVMUP_PREFIX=/usr/local ./install.sh

# Or in dedicated directory
LLVMUP_PREFIX=/opt/llvmup ./install.sh
```

### Package Manager Integration
```bash
# For creating packages
LLVMUP_PREFIX="$DESTDIR/usr" ./install.sh
```

## ðŸ”’ Safe Installation & Uninstallation

### Profile Modification Safety

The LLVM manager uses **safety markers** to ensure your personal shell configuration is never accidentally damaged during installation or removal:

#### Installation Safety
- **Marker-based configuration**: New installations use clear start/end markers:
  ```bash
  # LLVM Manager Functions - Start
  # Auto-generated by LLVMUP installer - safe to remove
  if [ -f "$HOME/.local/bin/llvm-functions.sh" ]; then
      source "$HOME/.local/bin/llvm-functions.sh"
  fi
  # LLVM Manager Functions - End
  ```
- **Duplicate detection**: Won't add configuration if already present
- **Safe profile selection**: Automatically chooses `.bashrc` or `.profile`

#### Uninstallation Safety
- **Backup creation**: Always creates `.llvmup-backup` before modifications
- **Precise removal**: Uses safety markers to remove only LLVM configuration
- **Conservative fallback**: For older installations, uses careful pattern matching
- **User content preservation**: Never touches your personal configuration

#### Migration from Old Format
If you have an older installation without safety markers, the uninstaller will:
1. Detect the old format
2. Use conservative removal methods
3. Preserve all your personal configuration
4. Create a backup for safety

### Testing Coverage
All safety mechanisms are thoroughly tested with:
- New format marker removal
- Old format conservative removal
- Complex user configuration preservation
- Edge cases and error conditions
